<div class="card route-card h-100 shadow-sm border-0 hover-shadow transition-all">
    <!-- Картинка маршрута -->
    <div class="route-image-container position-relative overflow-hidden">
        {% if route.photos.first %}
        <img src="{{ route.photos.first.image.url }}" class="card-img-top route-image" alt="{{ route.name }}"
             style="height: 200px; object-fit: cover; transition: transform 0.3s ease;">
        {% else %}
        <div class="card-img-top route-image-placeholder bg-gradient-primary text-white d-flex align-items-center justify-content-center"
             style="height: 200px;">
            <div class="text-center">
                <i class="fas fa-route fa-3x mb-2 opacity-75"></i>
                <p class="small mb-0 opacity-75">Фото не добавлено</p>
            </div>
        </div>
        {% endif %}
        
        <!-- Бейджи поверх изображения -->
        <div class="position-absolute top-0 start-0 m-3">
            <span class="badge bg-{% if route.route_type == 'walking' %}success{% elif route.route_type == 'driving' %}primary{% else %}warning{% endif %} bg-opacity-90 text-white">
                <i class="fas fa-{% if route.route_type == 'walking' %}walking{% elif route.route_type == 'driving' %}car{% else %}bicycle{% endif %} me-1"></i>
                {{ route.get_route_type_display }}
            </span>
        </div>
        
        <!-- Статус маршрута -->
        <div class="position-absolute top-0 end-0 m-3">
            {% if not route.is_active %}
            <span class="badge bg-danger bg-opacity-90 text-white">
                <i class="fas fa-pause-circle me-1"></i>Не активен
            </span>
            {% endif %}
        </div>
        
        <!-- Затемнение при наведении -->
        <div class="route-image-overlay position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-0 transition-all"
             style="pointer-events: none;"></div>
    </div>
    
    <div class="card-body d-flex flex-column p-4">
        <!-- Заголовок и меню -->
        <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title fw-bold text-dark mb-0 line-clamp-2" style="flex: 1;">
                {{ route.name }}
            </h5>
            <div class="dropdown ms-2">
                <button class="btn btn-sm btn-light rounded-circle hover-scale" 
                        type="button" 
                        data-bs-toggle="dropdown"
                        style="width: 32px; height: 32px;">
                    <i class="fas fa-ellipsis-v text-muted"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow border-0">
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2" 
                           href="{% url 'route_detail' route.id %}">
                            <i class="fas fa-eye text-primary me-2"></i>
                            <span>Просмотреть</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2" 
                           href="{% url 'chat:route_chat' route.id %}">
                            <i class="fas fa-comments text-info me-2"></i>
                            <span>Открыть чат</span>
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2" 
                           href="{% url 'edit_route' route.id %}">
                            <i class="fas fa-edit text-success me-2"></i>
                            <span>Редактировать</span>
                        </a>
                    </li>
                    <li><hr class="dropdown-divider my-1"></li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center py-2 {% if route.is_active %}text-warning{% else %}text-success{% endif %}" 
                           href="{% url 'toggle_route_active' route.id %}">
                            <i class="fas fa-power-off me-2"></i>
                            <span>{% if route.is_active %}Деактивировать{% else %}Активировать{% endif %}</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Описание -->
        <p class="card-text text-muted mb-3 flex-grow-1 line-clamp-3">
            {{ route.short_description|default:route.description|default:"Описание отсутствует"|truncatewords:20 }}
        </p>
        
        <!-- Дополнительные теги -->
        <div class="mb-3">
            {% if route.mood %}
            <span class="badge bg-info bg-opacity-10 text-info border-0 me-1 mb-1">
                <i class="fas fa-smile me-1"></i>{{ route.get_mood_display }}
            </span>
            {% endif %}
            {% if route.theme %}
            <span class="badge bg-purple bg-opacity-10 text-purple border-0 me-1 mb-1">
                <i class="fas fa-tag me-1"></i>{{ route.get_theme_display }}
            </span>
            {% endif %}
            {% if route.is_elderly_friendly %}
            <span class="badge bg-warning bg-opacity-10 text-warning border-0 me-1 mb-1">
                <i class="fas fa-wheelchair me-1"></i>Для пожилых
            </span>
            {% endif %}
            {% if route.has_audio_guide %}
            <span class="badge bg-secondary bg-opacity-10 text-secondary border-0 me-1 mb-1">
                <i class="fas fa-headphones me-1"></i>Аудиогид
            </span>
            {% endif %}
        </div>
        
        <!-- Кнопка открыть чат -->
        <div class="mb-3">
            <a href="{% url 'chat:route_chat' route.id %}" 
               class="btn btn-primary w-100 d-flex align-items-center justify-content-center py-2">
                <i class="fas fa-comments me-2"></i>
                Открыть чат
            </a>
        </div>
        
        <!-- Статистика и дата -->
        <div class="d-flex justify-content-between align-items-center mt-auto pt-3 border-top">
            <div class="d-flex gap-3 text-muted small">
                <div class="d-flex align-items-center">
                    <i class="fas fa-route text-primary me-1"></i>
                    <span>{{ route.total_distance|floatformat:1 }} км</span>
                </div>
                <div class="d-flex align-items-center">
                    <i class="fas fa-clock text-success me-1"></i>
                    <span>{{ route.duration_minutes }} мин</span>
                </div>
                <div class="d-flex align-items-center">
                    <i class="fas fa-map-marker-alt text-info me-1"></i>
                    <span>{{ route.points.count }}</span>
                </div>
            </div>
            
            <div class="text-muted small">
                <i class="fas fa-calendar me-1"></i>
                <span>{{ route.created_at|date:"d.m.Y" }}</span>
            </div>
        </div>
    </div>
</div>

<style>
.route-card {
    border-radius: 16px;
    transition: all 0.3s ease;
    overflow: hidden;
}

.route-card:hover {
    transform: translateY(-4px);
}

.hover-shadow:hover {
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.route-image-container:hover .route-image {
    transform: scale(1.05);
}

.route-image-container:hover .route-image-overlay {
    background-color: rgba(0,0,0,0.1);
}

.route-image-placeholder {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.hover-scale {
    transition: transform 0.2s ease;
}

.hover-scale:hover {
    transform: scale(1.1);
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.bg-purple {
    background-color: #6f42c1 !important;
}

.text-purple {
    color: #6f42c1 !important;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
}

.transition-all {
    transition: all 0.3s ease;
}

/* Анимация появления */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.route-card {
    animation: fadeInUp 0.5s ease-out;
}
</style>