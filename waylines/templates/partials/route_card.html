<!-- templates/routes/partials/route_card.html -->
<div class="card route-card h-100">
    {% if route.photos.first %}
    <img src="{{ route.photos.first.image.url }}" class="card-img-top route-image" alt="{{ route.name }}">
    {% else %}
    <div class="card-img-top route-image bg-light d-flex align-items-center justify-content-center">
        <i class="fas fa-route fa-2x text-muted"></i>
    </div>
    {% endif %}
    
    <div class="card-body d-flex flex-column">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title">{{ route.name }}</h5>
            <div class="dropdown">
                <button class="btn btn-sm btn-outline-secondary border-0" type="button" data-bs-toggle="dropdown">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" href="{% url 'route_detail' route.id %}">
                            <i class="fas fa-eye"></i> Просмотреть
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'edit_route' route.id %}">
                            <i class="fas fa-edit"></i> Редактировать
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item {% if route.is_active %}text-warning{% else %}text-success{% endif %}" 
                           href="{% url 'toggle_route_active' route.id %}">
                            <i class="fas fa-power-off"></i> 
                            {% if route.is_active %}Деактивировать{% else %}Активировать{% endif %}
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <p class="card-text text-muted small flex-grow-1">
            {{ route.short_description|default:route.description|truncatewords:15 }}
        </p>
        
        <div class="mb-2">
            <span class="badge bg-{% if route.route_type == 'walking' %}success{% elif route.route_type == 'driving' %}primary{% else %}warning{% endif %} me-1">
                {{ route.get_route_type_display }}
            </span>
            {% if route.mood %}
            <span class="badge bg-info me-1">{{ route.get_mood_display }}</span>
            {% endif %}
            {% if not route.is_active %}
            <span class="badge bg-danger">Не активен</span>
            {% endif %}
        </div>
        
        <div class="d-flex justify-content-between align-items-center mt-auto">
            <div class="small text-muted">
                <i class="fas fa-calendar"></i> {{ route.created_at|date:"d.m.Y" }}
            </div>
            <div class="d-flex gap-1">
                <span class="badge bg-light text-dark">
                    <i class="fas fa-route"></i> {{ route.total_distance|floatformat:1 }}км
                </span>
                <span class="badge bg-light text-dark">
                    <i class="fas fa-clock"></i> {{ route.duration_minutes }}мин
                </span>
            </div>
        </div>
    </div>
</div>